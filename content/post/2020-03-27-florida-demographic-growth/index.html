---
title: Florida Demographic Growth 
subtitle: "Working with Florida Health Charts data"
authors: 
- Andriy Koval
date: '2020-03-27'
slug: [florida-demographic-growth-2006-2020]
categories:
  - reproducible research
  - analytic workflow
  - graph making
tags:
  - demography
  - Florida
summary: 'This blogposts shows how to extract population estimates data reported by the Florida Department of Health, prepare them for analysis, and conduct basic exploration of the demographic growth'
lastmod: '2020-03-27'
featured: no
image:
  caption: ''
  focal_point: 'Center'
  preview_only: no
projects: []
url_code: "https://github.com/dss-hmi/suicide-prevention-2019"
url_dataset: ""
url_pdf: ""
url_poster: ""
url_project: ""
url_slides: ""
url_source: ""
url_video: ""
output:
  html_document:
    theme: simplex
    toc: true
    toc_depth: 3
    keep_md: true
    toc_float: true
    code_folding: show
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<!-- These two chunks should be added in the beginning of every .Rmd that you want to source an .R script -->
<!--  The 1st mandatory chunck  -->
<!--  Set the working directory to the repository's base directory -->
<!--  The 2nd mandatory chunck  -->
<!-- Set the report-wide options, and point to the external code file. -->
<div id="abstract" class="section level1">
<h1>Abstract</h1>
<p>This blogposts shows how to extract population estimates data reported by the Florida Department of Health, prepare them for analysis, and conduct basic exploration of the demographic growth.</p>
<p>See the report in its native environment of <a href="https://github.com/dss-hmi/suicide-prevention-2019">suicide-prevention-2019</a> repository <a href="https://raw.githack.com/dss-hmi/suicide-prevention-2019/3ff78365931214e342640523f2096c2eac443b2f/analysis/blogposts/florida-demographic-growth/fl-demo-growth.html">here</a></p>
</div>
<div id="environment" class="section level1">
<h1>Environment</h1>
<!-- Load 'sourced' R files.  Suppress the output when loading packages. -->
<pre class="r numberLines"><code># Attach these packages so their functions don&#39;t need to be qualified
# see http://r-pkgs.had.co.nz/namespace.html#search-path
library(magrittr) #Pipes
library(ggplot2)  # graphs
library(dplyr)
requireNamespace(&quot;tidyr&quot;)    # data tidying
requireNamespace(&quot;ggpubr&quot;)   # publication plots
requireNamespace(&quot;readxl&quot;)   # data import</code></pre>
</div>
<div id="data-wrangling" class="section level1">
<h1>Data Wrangling</h1>
<div id="data-origin" class="section level2">
<h2>Data Origin</h2>
<p>The initial extract of the data was obtained from <a href="http://www.flhealthcharts.com/FLQUERY/Population/PopulationRpt.aspx">www.flhealthcharts.com</a> a reporting tool for population counts estimated by the Florida Department of Health. The figure below shows the modifications to the default query the produces the data product used in this demonstration:</p>
<div class="figure">
<img src="data/FloridaPopulation-2006-2020.PNG" alt="" />
<p class="caption">View of the reporting tool</p>
</div>
<p>The tool gives the option to save the product of the query as an Excel book (<code>.xls</code>), however, the import of this extension into R has been problematic, so I have converted (“save as”) the file manually into a more modern Excel format, <code>.xlsx</code>. This file is the raw source for the current report and can be dowloaded for closer inspection <a href="https://github.com/dss-hmi/suicide-prevention-2019/raw/3ff78365931214e342640523f2096c2eac443b2f/analysis/blogposts/florida-demographic-growth/data/FloridaPopulation.xlsx">here</a>.</p>
</div>
<div id="data-import" class="section level2">
<h2>Data import</h2>
<p>The structure of the Excel file requires some tidying to enable a nimble analytic flow</p>
<div class="figure">
<img src="data/extracted-data.PNG" alt="" />
<p class="caption">View of the extracted data</p>
</div>
<!-- Load any Global functions and variables declared in the R file.  Suppress the output. -->
<pre class="r numberLines"><code># you will need to replace this path to the location where you stored your data file
path_file_input &lt;- &quot;./content/post/2020-03-27-florida-demographic-growth/data/FloridaPopulation.xlsx&quot;</code></pre>
<!-- Declare any global functions specific to a Rmd output.  Suppress the output. -->
<!-- # ```{r, echo=echoChunks, message=FALSE} -->
<!-- # #Put code in here.  It doesn't call a chunk in the codebehind file. -->
<!-- # ``` -->
<!-- Load the datasets.   -->
<pre class="r numberLines"><code>ds0 &lt;-  readxl::read_excel(path_file_input, col_names = FALSE, skip = 3)</code></pre>
</div>
<div id="data-tweaking" class="section level2">
<h2>Data Tweaking</h2>
<p>We can identify several problems to address:<br />
1. Not all columns have names<br />
2. <code>race</code>, <code>ethnicity</code>, <code>sex</code>, and <code>age_group</code> are stored in merged spreadsheet cells<br />
3. Sums for categories are recorded in rows as observations (e.g <code>Total</code>)<br />
4. Some values of <code>age_group</code> are misinterpreted as dates (e.g. <code>1-4</code> becomes <code>4-Jan</code>)<br />
5. <code>age_group</code> does not bin the population evenly (e.g. <code>20-24</code> vs <code>25-34</code>)</p>
<div id="tweak-1" class="section level3">
<h3>Tweak 1</h3>
<p>To address (1) we skipped the first 3 lines during import, and now need to assign the name of the columns manually:</p>
<pre class="r numberLines"><code>ds1 &lt;- ds0 # duplicate to preserve the original
# because we removed the row with columns names during import:
names(ds1) &lt;- c(&quot;race&quot;,&quot;ethnicity&quot;,&quot;sex&quot;,&quot;age_group&quot;,&quot;age&quot;,as.character(c(2006:2020)),&quot;total&quot;)
ds1 %&gt;% dplyr::glimpse(90)</code></pre>
<pre><code>Observations: 807
Variables: 21
$ race      &lt;chr&gt; &quot;White&quot;, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
$ ethnicity &lt;chr&gt; &quot;Hispanic&quot;, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
$ sex       &lt;chr&gt; &quot;Female&quot;, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
$ age_group &lt;chr&gt; &quot;&lt;1&quot;, NA, &quot;43834&quot;, NA, NA, NA, NA, &quot;43960&quot;, NA, NA, NA, NA, NA, &quot;44...
$ age       &lt;chr&gt; &quot;0&quot;, &quot;Total&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;Total&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;,...
$ `2006`    &lt;dbl&gt; 33295, 33295, 24323, 24323, 24323, 24323, 97292, 25382, 25382, 2538...
$ `2007`    &lt;dbl&gt; 32276, 32276, 25841, 25841, 25841, 25841, 103364, 26712, 26712, 267...
$ `2008`    &lt;dbl&gt; 30429, 30429, 28693, 28693, 28693, 28693, 114772, 27637, 27637, 276...
$ `2009`    &lt;dbl&gt; 29468, 29468, 29927, 29919, 29917, 29853, 119616, 28378, 28378, 283...
$ `2010`    &lt;dbl&gt; 33976, 33976, 24145, 24145, 24145, 24145, 96580, 25981, 25943, 2594...
$ `2011`    &lt;dbl&gt; 27302, 27302, 27206, 27206, 27206, 27206, 108825, 26380, 26380, 263...
$ `2012`    &lt;dbl&gt; 26795, 26795, 27566, 27566, 27566, 27566, 110264, 26817, 26817, 268...
$ `2013`    &lt;dbl&gt; 27240, 27240, 27774, 27774, 27774, 27774, 111097, 27613, 27613, 276...
$ `2014`    &lt;dbl&gt; 28288, 28288, 27816, 27816, 27816, 27816, 111262, 28375, 28375, 283...
$ `2015`    &lt;dbl&gt; 29203, 29203, 28638, 28638, 28638, 28638, 114550, 28991, 28991, 289...
$ `2016`    &lt;dbl&gt; 29889, 29889, 29643, 29643, 29643, 29643, 118572, 29658, 29658, 296...
$ `2017`    &lt;dbl&gt; 30593, 30593, 30386, 30386, 30386, 30386, 121545, 30362, 30362, 303...
$ `2018`    &lt;dbl&gt; 30399, 30399, 31398, 31398, 31398, 31398, 125592, 31198, 31198, 311...
$ `2019`    &lt;dbl&gt; 31781, 31781, 31781, 31781, 31781, 31781, 127125, 31937, 31937, 319...
$ `2020`    &lt;dbl&gt; 32313, 32313, 32313, 32313, 32313, 32313, 129252, 32476, 32476, 324...
$ total     &lt;dbl&gt; 453247, 453247, 427450, 427442, 427440, 427376, 1709708, 427898, 42...</code></pre>
<pre class="r numberLines"><code># Note, we will create a separate name (e.g. `ds1`, `ds2`, `ds3`, etc) only for the dataframes 
#we intend to keep, otherwise we will overwrite the existing to augment with trivial changes</code></pre>
</div>
<div id="tweak-2-and-3" class="section level3">
<h3>Tweak 2 and 3</h3>
<p>To address (2) we apply <code>tidyr::fill()</code> which carries the observation forward until it encounters a non-empty cell. <code>dplyr::filter</code> addresses (3), removing observations that store total counts, while <code>stringr::str_replace</code> recodes values that got misinterpreted as dates.</p>
<pre class="r numberLines"><code>ds1 &lt;- ds1 %&gt;%
  # carry observations forward to fill cells missing due to Excel structure ()
  tidyr::fill(race, ethnicity,sex,age_group, age) %&gt;% 
  dplyr::filter(!age == &quot;Total&quot;)  # because makes data untidy, we&#39;ll compute later
ds1 %&gt;% dplyr::glimpse(90)</code></pre>
<pre><code>Observations: 688
Variables: 21
$ race      &lt;chr&gt; &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;Whi...
$ ethnicity &lt;chr&gt; &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispan...
$ sex       &lt;chr&gt; &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female...
$ age_group &lt;chr&gt; &quot;&lt;1&quot;, &quot;43834&quot;, &quot;43834&quot;, &quot;43834&quot;, &quot;43834&quot;, &quot;43960&quot;, &quot;43960&quot;, &quot;43960&quot;...
$ age       &lt;chr&gt; &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;,...
$ `2006`    &lt;dbl&gt; 33295, 24323, 24323, 24323, 24323, 25382, 25382, 25382, 25382, 2538...
$ `2007`    &lt;dbl&gt; 32276, 25841, 25841, 25841, 25841, 26712, 26712, 26712, 26712, 2671...
$ `2008`    &lt;dbl&gt; 30429, 28693, 28693, 28693, 28693, 27637, 27637, 27637, 27637, 2763...
$ `2009`    &lt;dbl&gt; 29468, 29927, 29919, 29917, 29853, 28378, 28378, 28378, 28378, 2837...
$ `2010`    &lt;dbl&gt; 33976, 24145, 24145, 24145, 24145, 25981, 25943, 25943, 25914, 2591...
$ `2011`    &lt;dbl&gt; 27302, 27206, 27206, 27206, 27206, 26380, 26380, 26380, 26380, 2638...
$ `2012`    &lt;dbl&gt; 26795, 27566, 27566, 27566, 27566, 26817, 26817, 26817, 26817, 2681...
$ `2013`    &lt;dbl&gt; 27240, 27774, 27774, 27774, 27774, 27613, 27613, 27613, 27613, 2761...
$ `2014`    &lt;dbl&gt; 28288, 27816, 27816, 27816, 27816, 28375, 28375, 28375, 28375, 2837...
$ `2015`    &lt;dbl&gt; 29203, 28638, 28638, 28638, 28638, 28991, 28991, 28991, 28991, 2899...
$ `2016`    &lt;dbl&gt; 29889, 29643, 29643, 29643, 29643, 29658, 29658, 29658, 29658, 2965...
$ `2017`    &lt;dbl&gt; 30593, 30386, 30386, 30386, 30386, 30362, 30362, 30362, 30362, 3036...
$ `2018`    &lt;dbl&gt; 30399, 31398, 31398, 31398, 31398, 31198, 31198, 31198, 31198, 3119...
$ `2019`    &lt;dbl&gt; 31781, 31781, 31781, 31781, 31781, 31937, 31937, 31937, 31937, 3193...
$ `2020`    &lt;dbl&gt; 32313, 32313, 32313, 32313, 32313, 32476, 32476, 32476, 32476, 3247...
$ total     &lt;dbl&gt; 453247, 427450, 427442, 427440, 427376, 427898, 427860, 427860, 427...</code></pre>
</div>
<div id="tweak-4" class="section level3">
<h3>Tweak 4</h3>
<p>We need to do some investigation to address (4) and recode values that got misinterpreted as dates during the import</p>
<pre class="r numberLines"><code>ds1 %&gt;% dplyr::distinct(age_group) # to find out what strings got misinterpreted</code></pre>
<pre><code># A tibble: 13 x 1
   age_group
   &lt;chr&gt;    
 1 &lt;1       
 2 43834    
 3 43960    
 4 44118    
 5 15-19    
 6 20-24    
 7 25-34    
 8 35-44    
 9 45-54    
10 55-64    
11 65-74    
12 75-84    
13 85+      </code></pre>
<pre class="r numberLines"><code>ds1 %&gt;% 
  dplyr::filter(age_group %in% c(&quot;43834&quot;,&quot;43960&quot;,&quot;44118&quot;)) %&gt;% 
  dplyr::distinct(age_group, age) # to identify how to recode</code></pre>
<pre><code># A tibble: 14 x 2
   age_group age  
   &lt;chr&gt;     &lt;chr&gt;
 1 43834     1    
 2 43834     2    
 3 43834     3    
 4 43834     4    
 5 43960     5    
 6 43960     6    
 7 43960     7    
 8 43960     8    
 9 43960     9    
10 44118     10   
11 44118     11   
12 44118     12   
13 44118     13   
14 44118     14   </code></pre>
<pre class="r numberLines"><code># imlement the recoding
ds1 &lt;- ds1 %&gt;%   
  dplyr::mutate(
    age_group = stringr::str_replace(age_group, &quot;43834&quot;, &quot;1-4&quot;)
    ,age_group = stringr::str_replace(age_group, &quot;43960&quot;, &quot;5-9&quot;)
    ,age_group = stringr::str_replace(age_group, &quot;44118&quot;, &quot;10-14&quot;)
  ) %&gt;%
  dplyr::select(-total) # because it makes no sense in this context (adds up across the rows)
ds1 %&gt;% glimpse(90)</code></pre>
<pre><code>Observations: 688
Variables: 20
$ race      &lt;chr&gt; &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;Whi...
$ ethnicity &lt;chr&gt; &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispan...
$ sex       &lt;chr&gt; &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female...
$ age_group &lt;chr&gt; &quot;&lt;1&quot;, &quot;1-4&quot;, &quot;1-4&quot;, &quot;1-4&quot;, &quot;1-4&quot;, &quot;5-9&quot;, &quot;5-9&quot;, &quot;5-9&quot;, &quot;5-9&quot;, &quot;5-9&quot;...
$ age       &lt;chr&gt; &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;,...
$ `2006`    &lt;dbl&gt; 33295, 24323, 24323, 24323, 24323, 25382, 25382, 25382, 25382, 2538...
$ `2007`    &lt;dbl&gt; 32276, 25841, 25841, 25841, 25841, 26712, 26712, 26712, 26712, 2671...
$ `2008`    &lt;dbl&gt; 30429, 28693, 28693, 28693, 28693, 27637, 27637, 27637, 27637, 2763...
$ `2009`    &lt;dbl&gt; 29468, 29927, 29919, 29917, 29853, 28378, 28378, 28378, 28378, 2837...
$ `2010`    &lt;dbl&gt; 33976, 24145, 24145, 24145, 24145, 25981, 25943, 25943, 25914, 2591...
$ `2011`    &lt;dbl&gt; 27302, 27206, 27206, 27206, 27206, 26380, 26380, 26380, 26380, 2638...
$ `2012`    &lt;dbl&gt; 26795, 27566, 27566, 27566, 27566, 26817, 26817, 26817, 26817, 2681...
$ `2013`    &lt;dbl&gt; 27240, 27774, 27774, 27774, 27774, 27613, 27613, 27613, 27613, 2761...
$ `2014`    &lt;dbl&gt; 28288, 27816, 27816, 27816, 27816, 28375, 28375, 28375, 28375, 2837...
$ `2015`    &lt;dbl&gt; 29203, 28638, 28638, 28638, 28638, 28991, 28991, 28991, 28991, 2899...
$ `2016`    &lt;dbl&gt; 29889, 29643, 29643, 29643, 29643, 29658, 29658, 29658, 29658, 2965...
$ `2017`    &lt;dbl&gt; 30593, 30386, 30386, 30386, 30386, 30362, 30362, 30362, 30362, 3036...
$ `2018`    &lt;dbl&gt; 30399, 31398, 31398, 31398, 31398, 31198, 31198, 31198, 31198, 3119...
$ `2019`    &lt;dbl&gt; 31781, 31781, 31781, 31781, 31781, 31937, 31937, 31937, 31937, 3193...
$ `2020`    &lt;dbl&gt; 32313, 32313, 32313, 32313, 32313, 32476, 32476, 32476, 32476, 3247...</code></pre>
</div>
<div id="tweak-5" class="section level3">
<h3>Tweak 5</h3>
<p>Now we need to recode the values of <code>age</code> into a new grouping variable <code>age_group5</code>, which will correct the unevennes of the original grouping in <code>age_group</code></p>
<pre class="r numberLines"><code>ds1$age_group5 &lt;- ds1$age_group # because we want to keep the original for quality check
ds1$age_group5[ds1$age %in% c(0:4)]   &lt;- &quot;0-4&quot;
ds1$age_group5[ds1$age %in% c(25:29)] &lt;- &quot;25-29&quot;
ds1$age_group5[ds1$age %in% c(30:34)] &lt;- &quot;30-34&quot;
ds1$age_group5[ds1$age %in% c(35:39)] &lt;- &quot;35-39&quot;
ds1$age_group5[ds1$age %in% c(40:44)] &lt;- &quot;40-44&quot;
ds1$age_group5[ds1$age %in% c(45:49)] &lt;- &quot;45-49&quot;
ds1$age_group5[ds1$age %in% c(50:54)] &lt;- &quot;50-54&quot;
ds1$age_group5[ds1$age %in% c(55:59)] &lt;- &quot;55-59&quot;
ds1$age_group5[ds1$age %in% c(60:64)] &lt;- &quot;60-64&quot;
ds1$age_group5[ds1$age %in% c(65:69)] &lt;- &quot;65-69&quot;
ds1$age_group5[ds1$age %in% c(70:74)] &lt;- &quot;70-74&quot;
ds1$age_group5[ds1$age %in% c(75:79)] &lt;- &quot;75-79&quot;
ds1$age_group5[ds1$age %in% c(80:84)] &lt;- &quot;80-84&quot;

ds1 %&gt;% dplyr::distinct(age_group, age_group5) # to inspect the result</code></pre>
<pre><code># A tibble: 19 x 2
   age_group age_group5
   &lt;chr&gt;     &lt;chr&gt;     
 1 &lt;1        0-4       
 2 1-4       0-4       
 3 5-9       5-9       
 4 10-14     10-14     
 5 15-19     15-19     
 6 20-24     20-24     
 7 25-34     25-29     
 8 25-34     30-34     
 9 35-44     35-39     
10 35-44     40-44     
11 45-54     45-49     
12 45-54     50-54     
13 55-64     55-59     
14 55-64     60-64     
15 65-74     65-69     
16 65-74     70-74     
17 75-84     75-79     
18 75-84     80-84     
19 85+       85+       </code></pre>
</div>
<div id="pivot-long" class="section level3">
<h3>Pivot Long</h3>
<p>To enable a more seemless graph making, as well as to provide a more convenient shape for subsequent aggregation over age groups, we need to <code>tidyr:pivot_long</code> (formely known as <code>tidyr::gather</code>) the columns storing population estimates for each year.</p>
<pre class="r numberLines"><code># to translate into a longer form with respect to year
ds2 &lt;- ds1 %&gt;%
  tidyr::pivot_longer(cols = as.character(2006:2020),names_to = &quot;year&quot;, values_to = &quot;count&quot;) 
ds2 %&gt;% dplyr::glimpse(90)</code></pre>
<pre><code>Observations: 10,320
Variables: 8
$ race       &lt;chr&gt; &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;White&quot;, &quot;Wh...
$ ethnicity  &lt;chr&gt; &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispanic&quot;, &quot;Hispa...
$ sex        &lt;chr&gt; &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Female&quot;, &quot;Femal...
$ age_group  &lt;chr&gt; &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, &quot;&lt;1&quot;, ...
$ age        &lt;chr&gt; &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;...
$ age_group5 &lt;chr&gt; &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-4&quot;, &quot;0-...
$ year       &lt;chr&gt; &quot;2006&quot;, &quot;2007&quot;, &quot;2008&quot;, &quot;2009&quot;, &quot;2010&quot;, &quot;2011&quot;, &quot;2012&quot;, &quot;2013&quot;, &quot;2...
$ count      &lt;dbl&gt; 33295, 32276, 30429, 29468, 33976, 27302, 26795, 27240, 28288, 292...</code></pre>
<pre class="r numberLines"><code># `ds2` is the source set for computing totals because it has both `age_group`` categories</code></pre>
</div>
<div id="factors" class="section level3">
<h3>Factors</h3>
<p>Before aggregating over <code>age_group</code> and <code>age_group5</code> let us transform string variables into factors. so that we don’t have to do it in the individual data sets.</p>
<pre class="r numberLines"><code>lvl_age_groups &lt;-c(
  &quot;&lt;1&quot;
  ,&quot;1-4&quot;
  ,&quot;5-9&quot;
  ,&quot;10-14&quot;
  ,&quot;15-19&quot;
  ,&quot;20-24&quot;
  ,&quot;25-34&quot;
  ,&quot;35-44&quot;
  ,&quot;45-54&quot;
  ,&quot;55-64&quot;
  ,&quot;65-74&quot;
  ,&quot;75-84&quot;
  ,&quot;85+&quot;
)

lvl_age_groups5 &lt;- c(
  &quot;0-4&quot;
  ,&quot;5-9&quot;
  ,&quot;10-14&quot;
  ,&quot;15-19&quot;
  ,&quot;20-24&quot;
  ,&quot;25-29&quot;
  ,&quot;30-34&quot;
  ,&quot;35-39&quot;
  ,&quot;40-44&quot;
  ,&quot;45-49&quot;
  ,&quot;50-54&quot;
  ,&quot;55-59&quot;
  ,&quot;60-64&quot;
  ,&quot;65-69&quot;
  ,&quot;70-74&quot;
  ,&quot;75-79&quot;
  ,&quot;80-84&quot;
  ,&quot;85+&quot;
)
ds2 &lt;- ds2 %&gt;%
  dplyr::mutate(
    race_ethnicity = factor(paste0(race, &quot; + &quot;, ethnicity))
    ,race          = factor(race)
    ,ethnicity     = factor(ethnicity)
    ,age_group     = factor(age_group, levels = lvl_age_groups)
    ,age_group5    = factor(age_group5, levels = lvl_age_groups5)
    ,age           = as.integer(age)
    ,sex           = factor(sex)
    ,year          = as.integer(year)
  ) %&gt;% 
  dplyr::select(race, ethnicity, age_group, age_group5, dplyr::everything())
ds2 %&gt;% dplyr::glimpse(90)</code></pre>
<pre><code>Observations: 10,320
Variables: 9
$ race           &lt;fct&gt; White, White, White, White, White, White, White, White, White,...
$ ethnicity      &lt;fct&gt; Hispanic, Hispanic, Hispanic, Hispanic, Hispanic, Hispanic, Hi...
$ age_group      &lt;fct&gt; &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, &lt;1, 1-...
$ age_group5     &lt;fct&gt; 0-4, 0-4, 0-4, 0-4, 0-4, 0-4, 0-4, 0-4, 0-4, 0-4, 0-4, 0-4, 0-...
$ sex            &lt;fct&gt; Female, Female, Female, Female, Female, Female, Female, Female...
$ age            &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1,...
$ year           &lt;int&gt; 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 20...
$ count          &lt;dbl&gt; 33295, 32276, 30429, 29468, 33976, 27302, 26795, 27240, 28288,...
$ race_ethnicity &lt;fct&gt; White + Hispanic, White + Hispanic, White + Hispanic, White + ...</code></pre>
</div>
<div id="aggregate" class="section level3">
<h3>Aggregate</h3>
<p>Note that at this point, each row contains a population estimate for a given age in years. However, as you might have noticed that counts for each year of age are not unique:</p>
<pre class="r numberLines"><code>ds2 %&gt;% 
  dplyr::filter(
    age %in% c(25:39), race_ethnicity == &quot;White + Hispanic&quot;,sex == &quot;Female&quot;, year==2018
  ) %&gt;% 
  dplyr::select(race, ethnicity, age_group, age_group5, sex, age,count)</code></pre>
<pre><code># A tibble: 15 x 7
   race  ethnicity age_group age_group5 sex      age count
   &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;     &lt;fct&gt;      &lt;fct&gt;  &lt;int&gt; &lt;dbl&gt;
 1 White Hispanic  25-34     25-29      Female    25 34479
 2 White Hispanic  25-34     25-29      Female    26 34479
 3 White Hispanic  25-34     25-29      Female    27 34479
 4 White Hispanic  25-34     25-29      Female    28 34479
 5 White Hispanic  25-34     25-29      Female    29 34479
 6 White Hispanic  25-34     30-34      Female    30 35056
 7 White Hispanic  25-34     30-34      Female    31 35056
 8 White Hispanic  25-34     30-34      Female    32 35056
 9 White Hispanic  25-34     30-34      Female    33 35056
10 White Hispanic  25-34     30-34      Female    34 35056
11 White Hispanic  35-44     35-39      Female    35 36549
12 White Hispanic  35-44     35-39      Female    36 36549
13 White Hispanic  35-44     35-39      Female    37 36549
14 White Hispanic  35-44     35-39      Female    38 36549
15 White Hispanic  35-44     35-39      Female    39 36549</code></pre>
<p>In fact, it appears that Florida Health Charts computes the total for 5-year category and then devides it evenly among constituent elements of the <code>age_category</code>. My guess, this deals with privacy guidelines. Therefore, the most granualar age break up is only 5-year categories.</p>
<p>To preserve the original grouping we create two separate datasets, each providing the totals for respective age category.</p>
<pre class="r numberLines"><code>ds_age_group &lt;- ds2 %&gt;% 
  dplyr::group_by(race, ethnicity, sex, age_group, year) %&gt;% 
  dplyr::summarize(
    count = sum(count, na.rm = T)
  ) %&gt;% 
  dplyr::ungroup() %&gt;% 
  dplyr::mutate(
    race_ethnicity = paste0(race, &quot; + &quot;, ethnicity),
    race_ethnicity = factor(race_ethnicity)
  )

ds_age_group5 &lt;- ds2 %&gt;% 
  dplyr::group_by(race, ethnicity, sex, age_group5, year) %&gt;% 
  dplyr::summarize(
    count = sum(count, na.rm = T)
  ) %&gt;% 
  dplyr::ungroup() %&gt;% 
  dplyr::mutate(
    race_ethnicity = paste0(race, &quot; + &quot;, ethnicity),
    race_ethnicity = factor(race_ethnicity)
  )</code></pre>
<p>It is the <code>ds_age_group5</code> that will be focus of subsequent graphs. However, to better demonstrate why we needed to create new grouping of ages, we will preserve both dataframes.</p>
</div>
</div>
<div id="save-to-disk" class="section level2">
<h2>Save to disk</h2>
<pre class="r numberLines"><code>list(
  &quot;ds_wide&quot;        = ds1
  ,&quot;ds_long&quot;       = ds2
  ,&quot;ds_age_group&quot;  = ds_age_group
  ,&quot;ds_age_group3&quot; = ds_age_group5
) %&gt;% 
  saveRDS(&quot;./content/post/2020-03-27-florida-demographic-growth/data/clean_data.rds&quot;)</code></pre>
<p>The cleaned version of this dataset is available for download <a href="https://github.com/dss-hmi/suicide-prevention-2019/raw/3ff78365931214e342640523f2096c2eac443b2f/analysis/blogposts/florida-demographic-growth/data/clean_data.rds">here</a>.</p>
</div>
</div>
<div id="graphing" class="section level1">
<h1>Graphing</h1>
<div id="total-population" class="section level2">
<h2>Total population</h2>
<blockquote>
<p>How does the total population of Florida changes between 2006 and 2020?</p>
</blockquote>
<pre class="r numberLines"><code># Total population of Florida over the years
ds_age_group5 %&gt;% 
  dplyr::group_by(year) %&gt;% 
  dplyr::summarize(
    count = sum(count, na.rm = T)
  ) %&gt;% 
  ggplot(aes(x=year, y = count))+
  geom_point()+
  geom_line()+
  scale_y_continuous(labels = scales::comma)+
  theme_bw()</code></pre>
<p><img src="figure_rmd/g0-1.png" width="900px" /></p>
</div>
<div id="ethnic-groups-together" class="section level2">
<h2>Ethnic groups: Together</h2>
<blockquote>
<p>How does each ethnic group change during this time?</p>
</blockquote>
<pre class="r numberLines"><code># total population of Florida by broken down by 4 ethnic groups (race_ethnicity)
d1 &lt;- ds_age_group5 %&gt;% 
  dplyr::group_by(race_ethnicity, year) %&gt;% 
  dplyr::summarize(
    n_people = sum(count, rm.na = T)
  )
g1 &lt;- d1 %&gt;% 
  ggplot(aes(x = year,  y = n_people, color = race_ethnicity))+
  geom_line(aes(group = race_ethnicity))+
  geom_point(shape = 21, fill = NA, size =2)+
  scale_y_continuous(labels = scales::comma)+
  theme_bw()+
  theme(
    axis.text.x = element_text(angle = - 90,vjust =.5, hjust = -0)
    #https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2
  )+
  labs(
    title = &quot;Population growth in Florida over last 15 years \n  broken down by ethnic groups&quot;
    ,color = &quot;Ethnic Group&quot;
    ,x = &quot;Calendar Year&quot;
    ,y = &quot;Population Count&quot;
  )
g1</code></pre>
<p><img src="figure_rmd/g1-1.png" width="900px" /></p>
</div>
<div id="ethnic-groups-separate" class="section level2">
<h2>Ethnic groups: Separate</h2>
<blockquote>
<p>what Ethnic group is most dissimilar from the other three in their dynamics?</p>
</blockquote>
<pre class="r numberLines"><code># Q: what Ethnic group is most dissimilar from the other three in their dynamics?
g1 + facet_wrap(~race_ethnicity, scale = &quot;free_y&quot;)</code></pre>
<p><img src="figure_rmd/q1-1.png" width="900px" /></p>
<pre class="r numberLines"><code># A: &quot;White + Non-Hispanic&quot; because of a &quot;dip&quot; in late 2000&#39;s</code></pre>
</div>
<div id="age-composition-in-2019" class="section level2">
<h2>Age composition in 2019</h2>
<blockquote>
<p>What is the age composition of each ethnic group in 2019?</p>
</blockquote>
<pre class="r numberLines"><code># Build a graph showing age composition of all ethnic groups in 2019
g2 &lt;- ds_age_group5 %&gt;%
  dplyr::filter(year == 2019) %&gt;%
  ggplot(aes(x = age_group5, y = count, fill = race_ethnicity)) +
  geom_col()+
  facet_grid(sex ~ race_ethnicity)+
  scale_y_continuous(labels = scales::comma)+
  # https://stackoverflow.com/questions/14563989/force-r-to-stop-plotting-abbreviated-axis-labels-e-g-1e00-in-ggplot2 also https://r-graphics.org/recipe-axes-tick-label
  theme_bw()+
  theme(
     axis.text.x = element_text(angle = - 90,vjust =.5, hjust = -0)
     #https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2
  )+
  labs(
    title = &quot;Population in Florida in 2019 broken down by age groups and gender&quot;
    ,color = &quot;Ethnic Group&quot;
    ,x = &quot;Calendar Year&quot;
    ,y = &quot;Population Count&quot;
  )
g2</code></pre>
<p><img src="figure_rmd/g2-1.png" width="900px" /></p>
<blockquote>
<p>What would it look like if we used the original <code>age_group</code>?</p>
</blockquote>
<pre class="r numberLines"><code>g2a &lt;- ds_age_group %&gt;%
  dplyr::filter(year == 2019) %&gt;%
  ggplot(aes(x = age_group, y = count, fill = race_ethnicity)) +
  geom_col()+
  facet_grid(sex ~ race_ethnicity)+
  scale_y_continuous(labels = scales::comma)+
  # https://stackoverflow.com/questions/14563989/force-r-to-stop-plotting-abbreviated-axis-labels-e-g-1e00-in-ggplot2 also https://r-graphics.org/recipe-axes-tick-label
  theme_bw()+
  theme(
    axis.text.x = element_text(angle = - 90,vjust =.5, hjust = -0)
    #https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2
  )+
  labs(
    title = &quot;Population in Florida in 2019 broken down by age groups and gender&quot;
    ,color = &quot;Ethnic Group&quot;
    ,x = &quot;Calendar Year&quot;
    ,y = &quot;Population Count&quot;
  )
g2a</code></pre>
<p><img src="figure_rmd/q2-1.png" width="900px" /></p>
</div>
</div>
<div id="session-information" class="section level1">
<h1>session information</h1>
<p>For the sake of documentation and reproducibility, the current report was rendered in the following environment. Click the line below to expand.</p>
<details>
<p><summary>Environment <span class="glyphicon glyphicon-plus-sign"></span></summary></p>
<pre><code>- Session info -------------------------------------------------------------------------------------------------------
 setting  value                       
 version  R version 3.6.2 (2019-12-12)
 os       Windows 10 x64              
 system   x86_64, mingw32             
 ui       RTerm                       
 language (EN)                        
 collate  English_United States.1252  
 ctype    English_United States.1252  
 tz       America/New_York            
 date     2020-03-29                  

- Packages -----------------------------------------------------------------------------------------------------------
 package     * version date       lib source        
 assertthat    0.2.1   2019-03-21 [1] CRAN (R 3.6.2)
 backports     1.1.5   2019-10-02 [1] CRAN (R 3.6.1)
 blogdown      0.17    2019-11-13 [1] CRAN (R 3.6.2)
 bookdown      0.17    2020-01-11 [1] CRAN (R 3.6.2)
 callr         3.4.2   2020-02-12 [1] CRAN (R 3.6.2)
 cellranger    1.1.0   2016-07-27 [1] CRAN (R 3.6.2)
 cli           2.0.1   2020-01-08 [1] CRAN (R 3.6.2)
 colorspace    1.4-1   2019-03-18 [1] CRAN (R 3.6.1)
 crayon        1.3.4   2017-09-16 [1] CRAN (R 3.6.2)
 desc          1.2.0   2018-05-01 [1] CRAN (R 3.6.2)
 devtools      2.2.2   2020-02-17 [1] CRAN (R 3.6.3)
 digest        0.6.24  2020-02-12 [1] CRAN (R 3.6.2)
 dplyr       * 0.8.4   2020-01-31 [1] CRAN (R 3.6.2)
 ellipsis      0.3.0   2019-09-20 [1] CRAN (R 3.6.2)
 evaluate      0.14    2019-05-28 [1] CRAN (R 3.6.2)
 fansi         0.4.1   2020-01-08 [1] CRAN (R 3.6.2)
 fs            1.3.1   2019-05-06 [1] CRAN (R 3.6.2)
 ggplot2     * 3.2.1   2019-08-10 [1] CRAN (R 3.6.2)
 ggpubr        0.2.5   2020-02-13 [1] CRAN (R 3.6.2)
 ggsignif      0.6.0   2019-08-08 [1] CRAN (R 3.6.2)
 glue          1.3.1   2019-03-12 [1] CRAN (R 3.6.2)
 gtable        0.3.0   2019-03-25 [1] CRAN (R 3.6.2)
 htmltools     0.4.0   2019-10-04 [1] CRAN (R 3.6.2)
 knitr       * 1.28    2020-02-06 [1] CRAN (R 3.6.2)
 lazyeval      0.2.2   2019-03-15 [1] CRAN (R 3.6.2)
 lifecycle     0.1.0   2019-08-01 [1] CRAN (R 3.6.2)
 magrittr    * 1.5     2014-11-22 [1] CRAN (R 3.6.2)
 memoise       1.1.0   2017-04-21 [1] CRAN (R 3.6.2)
 munsell       0.5.0   2018-06-12 [1] CRAN (R 3.6.2)
 pillar        1.4.3   2019-12-20 [1] CRAN (R 3.6.2)
 pkgbuild      1.0.6   2019-10-09 [1] CRAN (R 3.6.2)
 pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 3.6.2)
 pkgload       1.0.2   2018-10-29 [1] CRAN (R 3.6.2)
 prettyunits   1.1.1   2020-01-24 [1] CRAN (R 3.6.2)
 processx      3.4.2   2020-02-09 [1] CRAN (R 3.6.2)
 ps            1.3.2   2020-02-13 [1] CRAN (R 3.6.2)
 purrr         0.3.3   2019-10-18 [1] CRAN (R 3.6.2)
 R6            2.4.1   2019-11-12 [1] CRAN (R 3.6.2)
 Rcpp          1.0.3   2019-11-08 [1] CRAN (R 3.6.2)
 readxl        1.3.1   2019-03-13 [1] CRAN (R 3.6.2)
 remotes       2.1.1   2020-02-15 [1] CRAN (R 3.6.2)
 rlang         0.4.4   2020-01-28 [1] CRAN (R 3.6.2)
 rmarkdown     2.1     2020-01-20 [1] CRAN (R 3.6.2)
 rprojroot     1.3-2   2018-01-03 [1] CRAN (R 3.6.2)
 scales        1.1.0   2019-11-18 [1] CRAN (R 3.6.2)
 sessioninfo   1.1.1   2018-11-05 [1] CRAN (R 3.6.2)
 stringi       1.4.5   2020-01-11 [1] CRAN (R 3.6.2)
 stringr       1.4.0   2019-02-10 [1] CRAN (R 3.6.2)
 testthat      2.3.1   2019-12-01 [1] CRAN (R 3.6.2)
 tibble        2.1.3   2019-06-06 [1] CRAN (R 3.6.2)
 tidyr         1.0.2   2020-01-24 [1] CRAN (R 3.6.2)
 tidyselect    1.0.0   2020-01-27 [1] CRAN (R 3.6.2)
 usethis       1.5.1   2019-07-04 [1] CRAN (R 3.6.2)
 utf8          1.1.4   2018-05-24 [1] CRAN (R 3.6.2)
 vctrs         0.2.2   2020-01-24 [1] CRAN (R 3.6.2)
 withr         2.1.2   2018-03-15 [1] CRAN (R 3.6.2)
 xfun          0.12    2020-01-13 [1] CRAN (R 3.6.2)
 yaml          2.2.1   2020-02-01 [1] CRAN (R 3.6.2)

[1] C:/Users/an499583/Documents/R/win-library/3.6
[2] C:/Program Files/R/R-3.6.2/library</code></pre>
</div>
